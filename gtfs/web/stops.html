<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bus stops browser</title>
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        #map {
            width: 100%;
            height: 100vh;
        }

    </style>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlT-tmubrpgPQIf2fSBiZ3wqa5bm3z2fg&callback=initMap">
    </script>
</head>
<body>
<div id="map"></div>
<script>


    function initMap() {
        var styleArray = [
             {
                featureType: "road.arterial",
                elementType: "geometry",
                stylers: [
                    {hue: "#00ffee"},
                    {saturation: 50}
                ]
            }, {
                featureType: "poi",
                elementType: "all",
                stylers: [
                    {visibility: "off"}
                ]
            }, {
                featureType: "transit.station",
                elementType: "geometry",
                stylers: [
                    {hue: "#ff0000"},
                    {saturation: 0}
                ]
            }
        ];

        var mapDiv = document.getElementById('map');
        var map = new google.maps.Map(mapDiv, {
            center: {lat: 31.784661, lng: 35.215089},
            zoom: 16
        });
        map.setOptions({styles: styleArray, clickableIcons: false});

        var infowindow = new google.maps.InfoWindow({});

        map.addListener('click', function (event) {
            var lat = event.latLng.lat();
            var lng = event.latLng.lng();
            var xhr = new XMLHttpRequest();
            xhr.open('GET', encodeURI('/stop?lat=' + lat + "&lng=" + lng));
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var stop = JSON.parse(xhr.responseText);

                    var marker = new google.maps.Marker({
                        position: {lat: parseFloat(stop.lat), lng: parseFloat(stop.lng)},
                        map: map
                    });
                    infowindow.setContent(xhr.responseText);
                    infowindow.open(map, marker)
                }
                else {
                    console.log('Request failed.  Returned status of ' + xhr.status);
                }
            };
            xhr.send();


        });


    }
</script>

</body>
</html>